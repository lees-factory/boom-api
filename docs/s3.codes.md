```java
@Slf4j
@Component
@RequiredArgsConstructor
public class S3FileStorageClient implements FileStorageClient {

    private final S3Client s3Client;

    private final S3Presigner s3Presigner;

    private final S3Properties s3Properties;

    @Override
    public String upload(byte[] fileData, String objectKey, long size, String contentType) {
        try {
            PutObjectRequest putOb =
                    PutObjectRequest.builder()
                            .bucket(s3Properties.getBucketName())
                            .key(objectKey)
                            .contentType(contentType)
                            .build();

            s3Client.putObject(putOb, RequestBody.fromBytes(fileData));

            log.info("File Uploaded: {}", objectKey);
            return objectKey;
        } catch (Exception e) {
            throw new RuntimeException("파일 업로드 실패", e);
        }
    }

    @Override
    public String generatePresignedUrl(String objectKey) {
        try {
            GetObjectPresignRequest presignRequest =
                    GetObjectPresignRequest.builder()
                            .signatureDuration(Duration.ofMinutes(10))
                            .getObjectRequest(
                                    b -> b.bucket(s3Properties.getBucketName()).key(objectKey))
                            .build();

            return s3Presigner.presignGetObject(presignRequest).url().toString();
        } catch (Exception e) {
            log.error("Presigned URL generation failed", e);
            throw new RuntimeException("URL 생성 실패", e);
        }
    }

    @Override
    public void delete(String objectKey) {
        try {
            s3Client.deleteObject(
                    builder -> builder.bucket(s3Properties.getBucketName()).key(objectKey));
            log.info("File Deleted: {}", objectKey);
        } catch (Exception e) {
            log.error("File deletion failed: {}", objectKey, e);
            throw new RuntimeException("파일 삭제 실패", e);
        }
    }
}

@Configuration
public class S3ClientConfig {

    @Bean
    public S3Client s3Client(S3Properties properties) {
        AwsBasicCredentials credentials =
            AwsBasicCredentials.create(properties.getAccessKey(), properties.getSecretKey());

        return S3Client.builder()
            .endpointOverride(URI.create(properties.getEndpoint()))
            .region(Region.of(properties.getRegion()))
            .credentialsProvider(StaticCredentialsProvider.create(credentials))
            .forcePathStyle(true)
            .build();
    }

    @Bean
    public S3Presigner s3Presigner(S3Properties properties) {
        AwsBasicCredentials credentials =
            AwsBasicCredentials.create(properties.getAccessKey(), properties.getSecretKey());

        return S3Presigner.builder()
            .endpointOverride(URI.create(properties.getEndpoint()))
            .region(Region.of(properties.getRegion()))
            .credentialsProvider(StaticCredentialsProvider.create(credentials))
            .serviceConfiguration(
                S3Configuration.builder().pathStyleAccessEnabled(true).build())
            .build();
    }
}

public interface FileStorageClient {

    /**
     * 파일을 업로드합니다.
     *
     * @param fileData 파일 데이터 (byte[])
     * @param objectKey 저장할 경로 키 (예: insurance/signatures/uuid.png)
     * @param size 파일 크기
     * @param contentType MIME 타입
     * @return 저장된 파일의 접근 경로 (Key)
     */
    String upload(byte[] fileData, String objectKey, long size, String contentType);

    /**
     * Presigned URL 생성 (다운로드/조회용)
     *
     * @param objectKey 저장된 파일 키
     * @return 다운로드 URL
     */
    String generatePresignedUrl(String objectKey);

    void delete(String objectKey);
}
@Getter
@Setter
@Configuration
@ConfigurationProperties(prefix = "s3")
public class S3Properties {

    private String endpoint;

    private String accessKey;

    private String secretKey;

    private String bucketName;

    private String region;
}



```
